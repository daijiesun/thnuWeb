<template>
    <div class="addUser container-fluid row">
        <form>
            <div class="form-group">
                <label for="userName">新密码</label>
                <input type="text" class="form-control" id="userName" placeholder="请输入新密码" autofocus v-model="modifyForm.password">
            </div>
            <div class="form-group">
                <label for="email">确认新密码</label>
                <input type="email" class="form-control" id="email" placeholder="请确认新密码" v-model="modifyForm.passwordOk">
            </div>
            <button type="button" class="btn btn-primary" @click="modifyPassword">确认修改</button>
        </form>
    </div>
</template>
<script>
import { mapGetters } from "vuex";
import userManage from "./UserManage.vue";
export default {
    data() {
        return {
            modifyForm: {
                password: null,
                passwordOk: null
            }
        };
    },
    components: {
        userManage
    },
    // mounted() {
    //     //获取当前需要修改用户的所有信息
    //     const id = this.$route.params.id;
    //     function checkId(item) {
    //         return (item._id = id);
    //     }
    //     this.modifyForm = this.userList.find(checkId);
    // },
    computed: {
        ...mapGetters({
            userList: "user/getUserList"
        })
    },
    methods: {
        //id: this.$route.params
        //修改用户
        modifyPassword: function() {
            if (this.modifyForm.password !== this.modifyForm.passwordOk) {
                 this.$toast.center("两次密码不同，请重新输入");
                return;
            } else if (
                !(this.modifyForm.password && this.modifyForm.passwordOk)
            ) {
                 this.$toast.center("输入不能为空");
                return 
            }
            let passwordObj = {
                id: this.$route.params.id,
                password: this.crypto(this.modifyForm.password)
            };
            this.axios
                .post("/admin/modifyPassword", passwordObj)
                .then(response => {
                    if (response.data.status == "success") {
                         this.$toast.center("修改成功");
                        this.$router.push({path: '/admin/userManage'});
                    } else {
                         this.$toast.center(response.data.message);
                    }
                })
                .catch(err => {
                    console.log(err);
                    this.$router.push({path: '/admin/userManage'});
                });
        }
    }
};
</script>
<style scoped>
.addUser {
    width: 70%;
    margin: 20px auto;
}
.modal_title {
    border-bottom: 1px solid #ccc;
    padding: 5px;
    text-align: center;
}
#modal_content {
    text-align: center;
}
</style>


